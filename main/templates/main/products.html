<!-- main/templates/main/products.html -->
{% extends 'main/base.html' %}

{% block title %}–¢–æ–≤–∞—Ä—ã - –¢–µ—Ö—Ä–µ—Å—É—Ä—Å{% endblock %}

{% block content %}
<!-- Hero —Å–µ–∫—Ü–∏—è -->
<section class="products-hero">
    <div class="container">
        <div class="hero-content">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
            <p class="hero-subtitle">–®–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>
        </div>
    </div>
</section>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<section class="filters-section">
    <div class="container">
        <div class="filters-card">
            <form method="get" class="search-filter-form" id="searchForm">
                <div class="search-group">
                    <div class="search-input-wrapper">
                        <span class="search-icon">üîç</span>
                        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." value="{{ search_query }}" class="search-input" id="searchInput" autocomplete="off">
                        <div class="search-suggestions" id="searchSuggestions"></div>
                    </div>
                    <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
                </div>
                
                <div class="filter-group">
                    <select name="category" class="category-select">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {% for category in categories %}
                            <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>
                                {{ category }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                {% if search_query or selected_category %}
                    <a href="{% url 'products' %}" class="clear-filters">
                        ‚úï –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </a>
                {% endif %}
            </form>
        </div>
    </div>
</section>

<!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="toast-container" class="toast-container"></div>

<!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="products-section">
    <div class="container">
        {% if products %}
            <!-- –ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã -->
            {% if similar_products and search_query %}
            <div class="similar-products-section">
                <h3 class="similar-title">–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ "{{ search_query }}"</h3>
                <div class="similar-products-grid">
                    {% for product in similar_products %}
                    <div class="similar-product-card">
                        <div class="similar-product-image">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                            {% else %}
                            <div class="product-image-placeholder">
                                <span class="placeholder-icon">‚öôÔ∏è</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="similar-product-info">
                            <h4>{{ product.name }}</h4>
                            <p class="similar-product-price">{{ product.price }} ‚ÇΩ</p>
                            {% if product.quantity > 0 %}
                                <span class="similar-stock in-stock">–í –Ω–∞–ª–∏—á–∏–∏</span>
                            {% else %}
                                <span class="similar-stock out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                            {% endif %}
                            <a href="{% url 'products' %}?search={{ product.name|urlencode }}" class="similar-view-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="search-results-info">
                <h2 class="results-title">
                    {% if search_query %}
                        –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ search_query }}"
                    {% else %}
                        –í—Å–µ —Ç–æ–≤–∞—Ä—ã
                    {% endif %}
                    <span class="results-count">({{ products.paginator.count }})</span>
                </h2>
            </div>
            
            <div class="products-grid">
                {% for product in products %}
                <div class="product-card">
                    <div class="product-badge">
                        {% if product.quantity > 0 %}
                            <span class="badge in-stock-badge">–í –Ω–∞–ª–∏—á–∏–∏</span>
                        {% else %}
                            <span class="badge out-of-stock-badge">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                        {% endif %}
                    </div>
                    
                    <div class="product-image">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                        {% else %}
                        <div class="product-image-placeholder">
                            <span class="placeholder-icon">‚öôÔ∏è</span>
                            <p>–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="product-content">
                        <h3 class="product-title">{{ product.name }}</h3>
                        <p class="product-article">–ê—Ä—Ç–∏–∫—É–ª: {{ product.article }}</p>
                        <p class="product-category">{{ product.category }}</p>
                        
                        <div class="product-meta">
                            <div class="price-section">
                                <span class="price">{{ product.price }} ‚ÇΩ</span>
                                {% if product.quantity > 0 %}
                                    <span class="stock-info">–í –Ω–∞–ª–∏—á–∏–∏: {{ product.quantity }} —à—Ç.</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if product.description %}
                        <p class="product-description">{{ product.description|truncatewords:15 }}</p>
                        {% endif %}
                        
                        <div class="product-actions">
                            {% if product.quantity > 0 %}
                                {% if user.is_authenticated %}
                                    <button type="button" class="add-to-cart-btn" data-product-id="{{ product.id }}">
                                        üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                {% else %}
                                    <a href="{% url 'login' %}?next={{ request.path }}" class="login-to-buy-btn">
                                        üîê –í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å
                                    </a>
                                {% endif %}
                            {% else %}
                                <button class="out-of-stock-btn" disabled>
                                    ‚è∏Ô∏è –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
        <div class="no-products">
            <div class="no-products-icon">üîç</div>
            <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            {% if search_query or selected_category %}
                <a href="{% url 'products' %}" class="btn btn-primary">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã</a>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if products.has_other_pages %}
        <div class="pagination">
            {% if products.has_previous %}
                <a href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="pagination-btn">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
            {% endif %}
            
            <span class="pagination-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ products.number }} –∏–∑ {{ products.paginator.num_pages }}
            </span>
            
            {% if products.has_next %}
                <a href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="pagination-btn">
                    –î–∞–ª–µ–µ ‚Üí
                </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>

<!-- CTA —Å–µ–∫—Ü–∏—è -->
<section class="products-cta">
    <div class="container">
        <div class="cta-content">
            <h2>–ù–µ –Ω–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π —Ç–æ–≤–∞—Ä?</h2>
            <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ - –º—ã –ø–æ–º–æ–∂–µ–º –ø–æ–¥–æ–±—Ä–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏</p>
            <div class="cta-buttons">
                <a href="/contacts/" class="btn btn-primary">
                    üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏
                </a>
                <a href="/services/" class="btn btn-secondary">
                    üõ†Ô∏è –ù–∞—à–∏ —É—Å–ª—É–≥–∏
                </a>
            </div>
        </div>
    </div>
</section>

<style>
.products-section .container {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    border-radius: 20px;
    padding: 32px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ */
.similar-products-section {
    margin-bottom: 3rem;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.similar-title {
    color: white;
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    text-align: center;
    font-weight: 600;
}

.similar-products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.similar-product-card {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.similar-product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.similar-product-image {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
}

.similar-product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.similar-product-info {
    flex: 1;
    min-width: 0;
}

.similar-product-info h4 {
    font-size: 0.9rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.similar-product-price {
    font-size: 1rem;
    font-weight: 700;
    color: #0052cc;
    margin-bottom: 0.25rem;
}

.similar-stock {
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    display: inline-block;
    margin-bottom: 0.5rem;
}

.similar-stock.in-stock {
    background: #e6ffed;
    color: #38a169;
}

.similar-stock.out-of-stock {
    background: #fed7d7;
    color: #e53e3e;
}

.similar-view-btn {
    display: inline-block;
    background: #0052cc;
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.similar-view-btn:hover {
    background: #0047b3;
    color: white;
    transform: translateY(-1px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ–∏—Å–∫–∞ */
.search-input-wrapper {
    position: relative;
    flex: 1;
}

.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
    display: none;
}

.search-suggestion-item {
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-bottom: 1px solid #f1f3f4;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: background-color 0.2s ease;
}

.search-suggestion-item:hover {
    background: #f8f9fa;
}

.search-suggestion-item:last-child {
    border-bottom: none;
}

.suggestion-icon {
    font-size: 1rem;
    color: #6c757d;
    flex-shrink: 0;
}

.suggestion-text {
    flex: 1;
    color: #2c3e50;
    font-weight: 500;
}

.suggestion-category {
    font-size: 0.8rem;
    color: #6c757d;
    background: #f8f9fa;
    padding: 0.2rem 0.5rem;
    border-radius: 8px;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ */
.search-results-info {
    margin-bottom: 2rem;
    text-align: center;
}

.results-title {
    color: white;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.results-count {
    color: #a0aec0;
    font-size: 1.2rem;
    font-weight: 400;
}

/* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.toast-container {
    position: fixed;
    top: 100px;
    right: 20px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

section {
    border-radius: 20px !important;
}

.filters-section{
    margin-top: 2%;
}

.toast {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-left: 4px solid;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    min-width: 300px;
    transform: translateX(400px);
    transition: transform 0.3s ease;
}

.toast.show {
    transform: translateX(0);
}

.toast.success {
    border-left-color: #48bb78;
    background: #f0fff4;
    color: #22543d;
}

.toast.error {
    border-left-color: #e53e3e;
    background: #fff5f5;
    color: #742a2a;
}

.toast-icon {
    font-size: 1.2rem;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
.products-hero {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 100px 0 60px;
    text-align: center;
    margin-top: 2%;
}

.products-hero h1 {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 1rem;
    background: linear-gradient(45deg, #fff, #e0e7ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 500px;
    margin: 0 auto;
}

.filters-section {
    padding: 2rem 0;
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
}

.filters-card {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.search-filter-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.search-group {
    display: flex;
    gap: 1rem;
    align-items: stretch;
}

.search-input-wrapper {
    position: relative;
    flex: 1;
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
}

.search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.search-btn {
    padding: 1rem 2rem;
    background: #0052cc;
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.search-btn:hover {
    background: #0047b3;
    transform: translateY(-2px);
}

.filter-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.category-select {
    padding: 1rem;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 0.9rem;
    background: white;
    min-width: 200px;
    transition: all 0.3s ease;
}

.category-select:focus {
    outline: none;
    border-color: #667eea;
}

.clear-filters {
    color: #e74c3c;
    text-decoration: none;
    font-weight: 500;
    align-self: flex-start;
    transition: color 0.3s ease;
}

.clear-filters:hover {
    color: #c0392b;
}

.products-section {
    padding: 3rem 0;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.product-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

.product-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.product-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 2;
}

.badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.in-stock-badge {
    background: #48bb78;
    color: white;
}

.out-of-stock-badge {
    background: #e53e3e;
    color: white;
}

.product-image {
    height: 200px;
    overflow: hidden;
    background: #f8f9fa;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image img {
    transform: scale(1.1);
}

.product-image-placeholder {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #6c757d;
}

.placeholder-icon {
    font-size: 3rem;
    margin-bottom: 0.5rem;
}

.product-content {
    padding: 1.5rem;
}

.product-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.5rem;
    line-height: 1.4;
}

.product-article {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.product-category {
    color: #667eea;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 1rem;
}

.product-meta {
    margin-bottom: 1rem;
}

.price-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.price {
    font-size: 1.5rem;
    font-weight: 800;
    color: #2c3e50;
}

.stock-info {
    font-size: 0.9rem;
    color: #48bb78;
    font-weight: 500;
}

.product-description {
    color: #6c757d;
    line-height: 1.5;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
}

.product-actions {
    margin-top: auto;
}

.add-to-cart-btn,
.login-to-buy-btn,
.out-of-stock-btn {
    width: 100%;
    padding: 1rem;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.add-to-cart-btn {
    background: #48bb78;
    color: white;
}

.add-to-cart-btn:hover {
    background: #38a169;
    transform: translateY(-2px);
}

.add-to-cart-btn.loading {
    background: #ed8936;
    cursor: not-allowed;
}

.login-to-buy-btn {
    background: #0052cc;
    color: white;
    text-decoration: none;
    text-align: center;
}

.login-to-buy-btn:hover {
    background: #0047b3;
    transform: translateY(-2px);
    color: white;
}

.out-of-stock-btn {
    background: #e2e8f0;
    color: #a0aec0;
    cursor: not-allowed;
}

.no-products {
    text-align: center;
    padding: 4rem 2rem;
    color: #6c757d;
}

.no-products-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.no-products h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
}

.pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem 0;
}

.pagination-btn {
    padding: 0.75rem 1.5rem;
    background: #0052cc;
    color: white;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.pagination-btn:hover {
    background: #0047b3;
    transform: translateY(-2px);
    color: white;
}

.pagination-info {
    color: #6c757d;
    font-weight: 500;
}

.products-cta {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 4rem 0;
    text-align: center;
}

.cta-content h2 {
    font-size: 2.2rem;
    margin-bottom: 1rem;
}

.cta-content p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 2rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.btn-primary {
    background: white;
    color: #667eea;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(255,255,255,0.3);
}

.btn-secondary {
    background: transparent;
    color: white;
    border-color: white;
}

.btn-secondary:hover {
    background: white;
    color: #667eea;
    transform: translateY(-3px);
}

@media (max-width: 768px) {
    .products-hero h1 {
        font-size: 2.2rem;
    }
    
    .search-group {
        flex-direction: column;
    }
    
    .filter-group {
        flex-direction: column;
    }
    
    .category-select {
        min-width: 100%;
    }
    
    .products-grid {
        grid-template-columns: 1fr;
    }
    
    .similar-products-grid {
        grid-template-columns: 1fr;
    }
    
    .similar-product-card {
        flex-direction: column;
        text-align: center;
    }
    
    .similar-product-image {
        width: 80px;
        height: 80px;
    }
    
    .pagination {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .cta-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 200px;
        justify-content: center;
    }

    .toast-container {
        right: 10px;
        left: 10px;
    }
    
    .toast {
        min-width: auto;
    }
    
    .results-title {
        font-size: 1.4rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.querySelector('.category-select');
    const searchInput = document.getElementById('searchInput');
    const searchSuggestions = document.getElementById('searchSuggestions');
    let searchTimeout;

    if (categorySelect) {
        categorySelect.addEventListener('change', function() {
            this.form.submit();
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
    function fetchSearchSuggestions(query) {
        if (query.length < 2) {
            hideSuggestions();
            return;
        }

        fetch(`/api/search-suggestions/?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                showSuggestions(data.suggestions, query);
            })
            .catch(error => {
                console.error('Error fetching suggestions:', error);
                hideSuggestions();
            });
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
    function showSuggestions(suggestions, query) {
        if (!suggestions || suggestions.length === 0) {
            hideSuggestions();
            return;
        }

        searchSuggestions.innerHTML = '';
        
        suggestions.forEach(suggestion => {
            const item = document.createElement('div');
            item.className = 'search-suggestion-item';
            item.innerHTML = `
                <span class="suggestion-icon">üîç</span>
                <span class="suggestion-text">${highlightMatch(suggestion.name, query)}</span>
                <span class="suggestion-category">${suggestion.category}</span>
            `;
            
            item.addEventListener('click', function() {
                searchInput.value = suggestion.name;
                hideSuggestions();
                document.getElementById('searchForm').submit();
            });
            
            searchSuggestions.appendChild(item);
        });

        searchSuggestions.style.display = 'block';
    }

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Ç–µ–∫—Å—Ç–µ
    function highlightMatch(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
    function hideSuggestions() {
        searchSuggestions.style.display = 'none';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                fetchSearchSuggestions(this.value);
            }, 300);
        });

        searchInput.addEventListener('focus', function() {
            if (this.value.length >= 2) {
                fetchSearchSuggestions(this.value);
            }
        });

        // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –ø–æ–ª—è
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                hideSuggestions();
            }
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        let selectedSuggestion = -1;
        
        searchInput.addEventListener('keydown', function(e) {
            const items = searchSuggestions.querySelectorAll('.search-suggestion-item');
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedSuggestion = Math.min(selectedSuggestion + 1, items.length - 1);
                updateSelectedSuggestion(items);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedSuggestion = Math.max(selectedSuggestion - 1, -1);
                updateSelectedSuggestion(items);
            } else if (e.key === 'Enter' && selectedSuggestion >= 0) {
                e.preventDefault();
                items[selectedSuggestion].click();
            } else if (e.key === 'Escape') {
                hideSuggestions();
                selectedSuggestion = -1;
            }
        });

        function updateSelectedSuggestion(items) {
            items.forEach((item, index) => {
                item.style.background = index === selectedSuggestion ? '#f8f9fa' : '';
            });
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <span class="toast-icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
            <span class="toast-message">${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 100);
        
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –≤ —Ö–µ–¥–µ—Ä–µ
    function updateCartCounter(count) {
        let cartCounter = document.querySelector('.cart-count');
        const cartLink = document.querySelector('a[href*="/cart/"]');
        
        if (count > 0) {
            if (!cartCounter) {
                cartCounter = document.createElement('span');
                cartCounter.className = 'cart-count';
                cartLink.appendChild(cartCounter);
            }
            cartCounter.textContent = count;
        } else if (cartCounter) {
            cartCounter.remove();
        }
    }

    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
    function getCSRFToken() {
        // –ò—â–µ–º CSRF —Ç–æ–∫–µ–Ω –≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ
        const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
        if (csrfInput) {
            return csrfInput.value;
        }
        
        // –ò–ª–∏ –≤ –º–µ—Ç–∞-—Ç–µ–≥–µ
        const metaToken = document.querySelector('meta[name="csrf-token"]');
        if (metaToken) {
            return metaToken.getAttribute('content');
        }
        
        // –ò–ª–∏ –≤ –∫—É–∫–∞—Ö
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É —á–µ—Ä–µ–∑ AJAX
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', async function(e) {
            e.preventDefault();
            
            const productId = this.getAttribute('data-product-id');
            const originalText = this.innerHTML;
            
            // –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            this.innerHTML = '‚è≥ –î–æ–±–∞–≤–ª—è–µ–º...';
            this.disabled = true;
            
            try {
                // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const formData = new FormData();
                const csrfToken = getCSRFToken();
                
                if (csrfToken) {
                    formData.append('csrfmiddlewaretoken', csrfToken);
                }
                
                console.log('Sending request to add product:', productId);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
                const response = await fetch(`/cart/add/${productId}/`, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                    },
                    body: formData,
                    credentials: 'same-origin'
                });
                
                console.log('Response status:', response.status);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Expected JSON but got:', text.substring(0, 200));
                    throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON –æ—Ç–≤–µ—Ç');
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    showToast(data.message || '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');
                    updateCartCounter(data.cart_count);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —É—Å–ø–µ—Ö–∞
                    this.innerHTML = '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!';
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 1500);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                this.innerHTML = originalText;
                this.disabled = false;
            }
        });
    });
});
</script>
{% endblock %}