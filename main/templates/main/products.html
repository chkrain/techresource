<!-- main/templates/main/products.html -->
{% extends 'main/base.html' %}
{% load query_transform %}

{% block title %}–¢–æ–≤–∞—Ä—ã - –¢–µ—Ö—Ä–µ—Å—É—Ä—Å{% endblock %}

{% block content %}
<!-- Hero —Å–µ–∫—Ü–∏—è -->
<section class="products-hero">
    <div class="container">
        <div class="hero-content">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
            <p class="hero-subtitle">–®–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>
        </div>
    </div>
</section>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<section class="products-main-section">
    <div class="container">
        <div class="products-layout">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <aside class="filters-sidebar">
                <div class="filters-header">
                    <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
                    <button type="button" class="clear-filters-btn" id="clearFiltersBtn">
                        –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
                
                <form method="get" class="filters-form" id="filtersForm">
                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
                    <input type="hidden" name="search" value="{{ search_query }}">
                    
                    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                    <div class="filter-group">
                        <h4>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h4>
                        <select name="category" class="filter-select" id="categorySelect">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            {% for category in categories %}
                                <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>
                                    {{ category }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
                    <div class="filter-group">
                        <h4>–¶–µ–Ω–∞, ‚ÇΩ</h4>
                        <div class="price-inputs">
                            <input type="number" name="price_min" placeholder="–û—Ç" value="{{ price_min }}" 
                                   class="price-input" id="priceMin" min="0">
                            <span class="price-separator">‚Äî</span>
                            <input type="number" name="price_max" placeholder="–î–æ" value="{{ price_max }}" 
                                   class="price-input" id="priceMax" min="0">
                        </div>
                        <div class="price-range-info">
                            {% if price_range.min_price or price_range.max_price %}
                                –î–∏–∞–ø–∞–∑–æ–Ω: {{ price_range.min_price|default:0 }} - {{ price_range.max_price|default:10000 }} ‚ÇΩ
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ª–∏—á–∏—é -->
                    <div class="filter-group">
                        <h4>–ù–∞–ª–∏—á–∏–µ</h4>
                        <label class="checkbox-label">
                            <input type="checkbox" name="in_stock" value="true" {% if in_stock %}checked{% endif %} id="inStockCheckbox">
                            <span class="checkmark"></span>
                            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
                        </label>
                    </div>
                    
                    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                    <div class="filter-group">
                        <h4>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h4>
                        <select name="sort_by" class="filter-select" id="sortSelect">
                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                            <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                            <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                            <option value="popularity" {% if sort_by == 'popularity' %}selected{% endif %}>–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
                            <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                            <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                            <option value="quantity" {% if sort_by == 'quantity' %}selected{% endif %}>–ü–æ –Ω–∞–ª–∏—á–∏—é</option>
                        </select>
                    </div>
                </form>
            </aside>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="products-content">
                <!-- –ü–æ–∏—Å–∫ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="products-header">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <span class="search-icon">üîç</span>
                            <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏–∫—É–ª—É, –æ–ø–∏—Å–∞–Ω–∏—é..." 
                                   value="{{ search_query }}" class="search-input" id="searchInput" autocomplete="off">
                            <div class="search-suggestions" id="searchSuggestions"></div>
                        </div>
                    </div>
                    
                    <div class="products-info">
                        <span class="results-count">
                            –ù–∞–π–¥–µ–Ω–æ: 
                            <span id="resultsCount">
                                {% if page_obj.paginator.count %}
                                    {{ page_obj.paginator.count }}
                                {% else %}
                                    0
                                {% endif %}
                            </span> 
                            —Ç–æ–≤–∞—Ä–æ–≤
                        </span>
                        <div class="view-controls">
                            <button type="button" class="view-btn active" data-view="grid" title="–°–µ—Ç–∫–∞">
                                ‚óºÔ∏è
                            </button>
                            <button type="button" class="view-btn" data-view="list" title="–°–ø–∏—Å–æ–∫">
                                ‚ò∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="active-filters" id="activeFilters">
                    {% if search_query %}
                    <span class="active-filter">
                        –ü–æ–∏—Å–∫: "{{ search_query }}"
                        <button type="button" data-filter="search">√ó</button>
                    </span>
                    {% endif %}
                    {% if selected_category %}
                    <span class="active-filter">
                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ selected_category }}
                        <button type="button" data-filter="category">√ó</button>
                    </span>
                    {% endif %}
                    {% if selected_brand %}
                    <span class="active-filter">
                        –ë—Ä–µ–Ω–¥: {{ selected_brand }}
                        <button type="button" data-filter="brand">√ó</button>
                    </span>
                    {% endif %}
                    {% if price_min or price_max %}
                    <span class="active-filter">
                        –¶–µ–Ω–∞: {{ price_min|default:0 }} - {{ price_max|default:'‚àû' }} ‚ÇΩ
                        <button type="button" data-filter="price">√ó</button>
                    </span>
                    {% endif %}
                    {% if in_stock %}
                    <span class="active-filter">
                        –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
                        <button type="button" data-filter="in_stock">√ó</button>
                    </span>
                    {% endif %}
                </div>
                
                <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div id="productsContainer">
                    {% include 'main/components/product_grid.html' %}
                </div>
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                {% if page_obj.has_other_pages %}
                <div class="pagination" id="paginationContainer">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="pagination-btn" data-page="{{ page_obj.previous_page_number }}">
                            ‚Üê –ù–∞–∑–∞–¥
                        </a>
                    {% endif %}
                    
                    <span class="pagination-info">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span id="currentPage">{{ page_obj.number }}</span> –∏–∑ <span id="totalPages">{{ page_obj.paginator.num_pages }}</span>
                    </span>
                    
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="pagination-btn" data-page="{{ page_obj.next_page_number }}">
                            –î–∞–ª–µ–µ ‚Üí
                        </a>
                    {% endif %}
                </div>
                {% endif %}
                
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã...</p>
                </div>
            </main>
        </div>
    </div>
</section>

<!-- CTA —Å–µ–∫—Ü–∏—è -->
<section class="products-cta">
    <div class="container">
        <div class="cta-content">
            <h2>–ù–µ –Ω–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π —Ç–æ–≤–∞—Ä?</h2>
            <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ - –º—ã –ø–æ–º–æ–∂–µ–º –ø–æ–¥–æ–±—Ä–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏</p>
            <div class="cta-buttons">
                <a href="/contacts/" class="btn btn-primary">
                    üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏
                </a>
                <a href="/services/" class="btn btn-secondary">
                    üõ†Ô∏è –ù–∞—à–∏ —É—Å–ª—É–≥–∏
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="toast-container" class="toast-container"></div>

<style>
section {
    margin-top: 4%;
    border-radius: 20px;
}

.products-hero {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 4rem 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.products-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.1);
    z-index: 1;
}

.products-hero .hero-content {
    position: relative;
    z-index: 2;
}

.products-hero h1 {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    line-height: 1.2;
}

.hero-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.products-main-section {
    padding: 2rem 0;
    background: linear-gradient(135deg, #434e58 0%, #34495e 100%);
    min-height: 80vh;
}

.products-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 2rem;
    align-items: start;
}

/* –§–∏–∫—Å–∏—Ä—É–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å */
.filters-sidebar {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    position: sticky;
    top: 120px;
    max-height: calc(100vh - 140px);
    overflow-y: auto;
    overflow-x: hidden;
    z-index: 90;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
.filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f1f3f4;
}

.filters-header h3 {
    margin: 0;
    color: #2c3e50;
    font-size: 1.3rem;
    font-weight: 700;
}

.clear-filters-btn {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.clear-filters-btn:hover {
    background: #c0392b;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
}

/* –ì—Ä—É–ø–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
.filter-group {
    margin-bottom: 1.8rem;
}

.filter-group h4 {
    margin: 0 0 0.75rem 0;
    color: #2c3e50;
    font-size: 1rem;
    font-weight: 600;
}

.filter-select {
    width: 100%;
    padding: 0.85rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 0.95rem;
    background: white;
    transition: all 0.3s ease;
    max-width: 100%;
    box-sizing: border-box;
    cursor: pointer;
    color: black;
}

select.filter-select * {
    background-color: white !important;
    color: black !important;
}

/* –î–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –Ω–∞ WebKit (Chrome, Safari) */
select.filter-select option {
    background: white !important;
    color: black !important;
}

/* –î–ª—è Firefox */
select.filter-select:-moz-focusring {
    color: black !important;
    text-shadow: 0 0 0 #000 !important;
}

select.filter-select option:checked {
    background: #667eea !important;
    color: white !important;
}

.filter-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã */
.price-inputs {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    flex-wrap: nowrap;
}

.price-input {
    flex: 1;
    padding: 0.85rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 0.95rem;
    text-align: center;
    min-width: 0;
    box-sizing: border-box;
    transition: all 0.3s ease;
}

.price-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.price-separator {
    color: #6c757d;
    font-weight: 600;
    flex-shrink: 0;
    padding: 0 0.5rem;
}

.price-range-info {
    font-size: 0.85rem;
    color: #6c757d;
    text-align: center;
    word-break: break-word;
    padding: 0.5rem;
    background: #f8f9fa;
    border-radius: 8px;
}

/* –ß–µ–∫–±–æ–∫—Å */
.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 0.95rem;
    color: #2c3e50;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.checkbox-label:hover {
    background: #f8f9fa;
}

.checkbox-label input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin: 0;
    cursor: pointer;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
.products-content {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    min-height: 500px;
    overflow: hidden;
    position: relative;
    z-index: 80;
}

/* –®–∞–ø–∫–∞ —Å –ø–æ–∏—Å–∫–æ–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
.products-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.search-container {
    flex: 1;
    min-width: 300px;
    max-width: 600px;
}

.search-input-wrapper {
    position: relative;
    width: 100%;
}

.search-icon {
    position: absolute;
    left: 1.2rem;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    z-index: 10;
    font-size: 1.1rem;
}

.search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3.5rem;
    border: 2px solid #e9ecef;
    border-radius: 15px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
    box-sizing: border-box;
    font-weight: 500;
}

.search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
}

.products-info {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-shrink: 0;
}

.results-count {
    color: #2c3e50;
    font-weight: 600;
    font-size: 1rem;
    white-space: nowrap;
}

.view-controls {
    display: flex;
    gap: 0.5rem;
    background: #f8f9fa;
    padding: 0.5rem;
    border-radius: 12px;
    flex-shrink: 0;
}

.view-btn {
    background: transparent;
    border: none;
    padding: 0.75rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 44px;
    min-height: 44px;
}

.view-btn.active {
    background: #667eea;
    color: white;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.view-btn:hover:not(.active) {
    background: #e9ecef;
    transform: translateY(-1px);
}

/* –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã */
.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 2rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    border-radius: 15px;
    border: none;
    max-width: 100%;
    box-sizing: border-box;
}

.active-filter {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(255, 255, 255, 0.95);
    color: #2c3e50;
    padding: 0.6rem 1rem;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 600;
    white-space: nowrap;
    max-width: 100%;
    box-sizing: border-box;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.active-filter button {
    background: #e74c3c;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.active-filter button:hover {
    background: #c0392b;
    transform: scale(1.1);
}

/* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
    width: 100%;
    box-sizing: border-box;
}

.products-grid.list-view {
    grid-template-columns: 1fr;
}

.products-grid.list-view .product-card {
    display: flex;
    align-items: center;
    gap: 2rem;
    padding: 1.5rem;
    width: 100%;
    box-sizing: border-box;
}

.products-grid.list-view .product-image {
    width: 140px;
    height: 140px;
    flex-shrink: 0;
    margin: 0;
}

.products-grid.list-view .product-content {
    flex: 1;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto;
    align-items: center;
    gap: 1.5rem;
    padding: 0;
    min-width: 0;
}

.products-grid.list-view .product-title {
    margin-bottom: 0.5rem;
    word-break: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
}

.products-grid.list-view .product-meta {
    margin: 0;
    text-align: center;
    min-width: 0;
}

.products-grid.list-view .product-actions {
    margin: 0;
    min-width: 160px;
    flex-shrink: 0;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
.product-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: all 0.4s ease;
    position: relative;
    width: 100%;
    box-sizing: border-box;
    border: 1px solid #f1f3f4;
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
}

.product-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 5;
}

.badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.in-stock-badge {
    background: #48bb78;
    color: white;
    box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
}

.out-of-stock-badge {
    background: #e53e3e;
    color: white;
    box-shadow: 0 2px 8px rgba(229, 62, 62, 0.3);
}

.product-wishlist {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 5;
}

.wishlist-btn {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.3rem;
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.wishlist-btn:hover {
    background: white;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.wishlist-btn.in-wishlist {
    color: white;
}

.product-image {
    height: 220px;
    overflow: hidden;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    position: relative;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
}

.product-card:hover .product-image img {
    transform: scale(1.08);
}

.product-image-placeholder {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    padding: 2rem;
    text-align: center;
}

.placeholder-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.6;
}

.product-content {
    padding: 1.5rem;
    width: 100%;
    box-sizing: border-box;
}

.product-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.75rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-word;
}

.product-article {
    color: #6c757d;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    word-break: break-word;
    font-weight: 500;
}

.btn-details {
    margin-top: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    flex: 1;
    width: 100%;
    text-align: center;
}

.btn-details:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    color: white;
    text-decoration: none;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .product-actions {
        flex-direction: column;
    }
    
    .product-actions .btn-details {
        min-width: 100%;
        width: 100%;
        padding: 0.875rem 1rem;
    }
}

.product-category {
    color: #667eea;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    word-break: break-word;
}

.product-brand {
    color: #8e9aaf;
    font-size: 0.85rem;
    margin-bottom: 1rem;
    word-break: break-word;
    font-weight: 500;
}

.product-meta {
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.price-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.price {
    font-size: 1.5rem;
    font-weight: 800;
    color: #2c3e50;
    white-space: nowrap;
}

.stock-info {
    font-size: 0.9rem;
    color: #48bb78;
    font-weight: 600;
    white-space: nowrap;
}

.rating-section {
    text-align: right;
}

.rating {
    font-size: 0.9rem;
    color: #f59e0b;
    font-weight: 600;
}

.product-description {
    color: #6c757d;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-word;
}

.product-actions {
    margin-top: auto;
}

.add-to-cart-btn,
.login-to-buy-btn,
.out-of-stock-btn {
    width: 100%;
    padding: 1rem;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    box-sizing: border-box;
    word-break: break-word;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.add-to-cart-btn {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
}

.add-to-cart-btn:hover {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
}

.add-to-cart-btn.loading {
    background: #ed8936;
    cursor: not-allowed;
}

.login-to-buy-btn {
    background: linear-gradient(135deg, #0052cc 0%, #0047b3 100%);
    color: white;
    text-decoration: none;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 82, 204, 0.3);
}

.login-to-buy-btn:hover {
    background: linear-gradient(135deg, #0047b3 0%, #003d99 100%);
    transform: translateY(-2px);
    color: white;
    box-shadow: 0 6px 20px rgba(0, 82, 204, 0.4);
}

.out-of-stock-btn {
    background: #e2e8f0;
    color: #a0aec0;
    cursor: not-allowed;
    box-shadow: none;
}

/* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
.pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem 0;
    border-top: 2px solid #f1f3f4;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.pagination-btn {
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    text-align: center;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.pagination-btn:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6b46c1 100%);
    transform: translateY(-2px);
    color: white;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.pagination-info {
    color: #6c757d;
    font-weight: 600;
    font-size: 1rem;
    text-align: center;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading-indicator {
    text-align: center;
    padding: 4rem;
    color: #6c757d;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1.5rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∏—Å–∫–∞ */
.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #667eea;
    border-top: none;
    border-radius: 0 0 15px 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    z-index: 1000;
    max-height: 350px;
    overflow-y: auto;
    display: none;
}

.search-suggestion-item {
    padding: 1rem 1.5rem;
    cursor: pointer;
    border-bottom: 1px solid #f1f3f4;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: background-color 0.3s ease;
    word-break: break-word;
}

.search-suggestion-item:hover {
    background: #f8f9fa;
}

.search-suggestion-item:last-child {
    border-bottom: none;
}

.suggestion-icon {
    font-size: 1.2rem;
    color: #667eea;
    flex-shrink: 0;
}

.suggestion-text {
    flex: 1;
    color: #2c3e50;
    font-weight: 600;
    word-break: break-word;
}

.suggestion-category {
    font-size: 0.8rem;
    color: #6c757d;
    background: #f8f9fa;
    padding: 0.3rem 0.75rem;
    border-radius: 10px;
    white-space: nowrap;
    font-weight: 500;
}

/* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.toast-container {
    position: fixed;
    top: 120px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.toast {
    background: white;
    padding: 1.25rem 1.75rem;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    border-left: 5px solid;
    display: flex;
    align-items: center;
    gap: 1rem;
    min-width: 320px;
    transform: translateX(400px);
    transition: transform 0.4s ease;
    max-width: calc(100vw - 40px);
    box-sizing: border-box;
}

.toast.show {
    transform: translateX(0);
}

.toast.success {
    border-left-color: #48bb78;
    background: #f0fff4;
    color: #22543d;
}

.toast.error {
    border-left-color: #e53e3e;
    background: #fff5f5;
    color: #742a2a;
}

.toast-icon {
    font-size: 1.4rem;
    flex-shrink: 0;
}

/* CTA —Å–µ–∫—Ü–∏—è */
.products-cta {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 5rem 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.products-cta::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.1);
    z-index: 1;
}

.cta-content {
    position: relative;
    z-index: 2;
}

.cta-content h2 {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.cta-content p {
    font-size: 1.3rem;
    opacity: 0.9;
    margin-bottom: 3rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

.cta-buttons {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.25rem 2.5rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.4s ease;
    border: 2px solid transparent;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn-primary {
    background: white;
    color: #667eea;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255,255,255,0.3);
    color: #667eea;
}

.btn-secondary {
    background: transparent;
    color: white;
    border-color: white;
}

.btn-secondary:hover {
    background: white;
    color: #667eea;
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255,255,255,0.3);
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.no-products {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    width: 100%;
    box-sizing: border-box;
}

.similar-products {
    margin-top: 4rem;
    padding-top: 3rem;
    border-top: 2px solid #e9ecef;
    width: 100%;
    box-sizing: border-box;
}

.similar-products .products-grid {
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ z-index –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.search-suggestions,
.filter-select {
    z-index: 1000;
}

/* –£–±–∏—Ä–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
body {
    overflow-x: hidden;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .products-layout {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .filters-sidebar {
        position: static;
        max-height: none;
        margin-bottom: 1.5rem;
        z-index: auto;
    }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    }
    
    .products-hero h1 {
        font-size: 2.5rem;
    }
}

@media (max-width: 768px) {
    .products-hero {
        padding: 3rem 0;
    }
    
    .products-hero h1 {
        font-size: 2.2rem;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
    }
    
    .products-header {
        flex-direction: column;
        align-items: stretch;
        gap: 1.5rem;
    }
    
    .search-container {
        min-width: 100%;
        max-width: 100%;
    }
    
    .products-info {
        justify-content: space-between;
        width: 100%;
    }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1.5rem;
    }
    
    .products-grid.list-view .product-content {
        grid-template-columns: 1fr;
        text-align: left;
        gap: 1rem;
    }
    
    .products-grid.list-view .product-card {
        flex-direction: column;
        text-align: left;
        align-items: flex-start;
    }
    
    .products-grid.list-view .product-image {
        width: 100%;
        height: 200px;
    }
    
    .pagination {
        flex-direction: column;
        gap: 1.5rem;
        text-align: center;
    }
    
    .price-inputs {
        flex-wrap: wrap;
    }
    
    .price-input {
        min-width: calc(50% - 0.75rem);
    }
    
    .active-filters {
        padding: 1rem;
    }
    
    .active-filter {
        font-size: 0.8rem;
        padding: 0.5rem 0.9rem;
    }
    
    .toast-container {
        right: 10px;
        left: 10px;
        top: 100px;
    }
    
    .toast {
        min-width: auto;
        max-width: none;
    }
    
    .cta-content h2 {
        font-size: 2rem;
    }
    
    .cta-content p {
        font-size: 1.1rem;
    }
    
    .btn {
        padding: 1rem 2rem;
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .products-main-section .container {
        padding: 0 1rem;
    }
    
    .filters-sidebar,
    .products-content {
        padding: 1.25rem;
    }
    
    .product-content {
        padding: 1.25rem;
    }
    
    .products-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .products-header {
        gap: 1rem;
    }
    
    .search-input {
        font-size: 0.9rem;
        padding: 0.9rem 0.9rem 0.9rem 3rem;
    }
    
    .results-count {
        font-size: 0.9rem;
    }
    
    .view-controls {
        padding: 0.3rem;
    }
    
    .view-btn {
        padding: 0.6rem;
        font-size: 1rem;
    }
    
    .product-title {
        font-size: 1.1rem;
    }
    
    .price {
        font-size: 1.3rem;
    }
    
    .add-to-cart-btn,
    .login-to-buy-btn,
    .out-of-stock-btn {
        font-size: 0.9rem;
        padding: 0.9rem;
    }
    
    .pagination-btn {
        padding: 0.9rem 1.8rem;
        font-size: 0.9rem;
    }
    
    .filter-group h4 {
        font-size: 0.9rem;
    }
    
    .filter-select,
    .price-input {
        font-size: 0.9rem;
        padding: 0.8rem;
    }
    
    .products-hero h1 {
        font-size: 1.8rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .cta-content h2 {
        font-size: 1.8rem;
    }
    
    .cta-content p {
        font-size: 1rem;
    }
    
    .cta-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 280px;
        justify-content: center;
    }
}
</style>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentPage = 1;
let isLoading = false;
let searchTimeout;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function updateURL(params) {
    const url = new URL(window.location);
    Object.keys(params).forEach(key => {
        if (params[key]) {
            url.searchParams.set(key, params[key]);
        } else {
            url.searchParams.delete(key);
        }
    });
    url.searchParams.delete('page'); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    window.history.replaceState({}, '', url);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
function updateFilters() {
    const form = document.getElementById('filtersForm');
    const formData = new FormData(form);
    const params = {};
    
    for (let [key, value] of formData.entries()) {
        params[key] = value;
    }
    
    // –î–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–≤ –Ω–∞–ª–∏—á–∏–∏"
    if (!params.in_stock) {
        params.in_stock = '';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º URL
    updateURL(params);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    updateActiveFilters(params);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
    loadProducts(1, params);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
function updateActiveFilters(params) {
    const activeFiltersContainer = document.getElementById('activeFilters');
    if (!activeFiltersContainer) return;
    
    let activeFiltersHTML = '';
    
    // –ü–æ–∏—Å–∫
    if (params.search) {
        activeFiltersHTML += `
            <span class="active-filter">
                –ü–æ–∏—Å–∫: "${params.search}"
                <button type="button" data-filter="search">√ó</button>
            </span>
        `;
    }
    
    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    if (params.category) {
        activeFiltersHTML += `
            <span class="active-filter">
                –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${params.category}
                <button type="button" data-filter="category">√ó</button>
            </span>
        `;
    }
    
    // –ë—Ä–µ–Ω–¥
    if (params.brand) {
        activeFiltersHTML += `
            <span class="active-filter">
                –ë—Ä–µ–Ω–¥: ${params.brand}
                <button type="button" data-filter="brand">√ó</button>
            </span>
        `;
    }
    
    // –¶–µ–Ω–∞
    if (params.price_min || params.price_max) {
        activeFiltersHTML += `
            <span class="active-filter">
                –¶–µ–Ω–∞: ${params.price_min || 0} - ${params.price_max || '‚àû'} ‚ÇΩ
                <button type="button" data-filter="price">√ó</button>
            </span>
        `;
    }
    
    // –í –Ω–∞–ª–∏—á–∏–∏
    if (params.in_stock === 'true') {
        activeFiltersHTML += `
            <span class="active-filter">
                –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
                <button type="button" data-filter="in_stock">√ó</button>
            </span>
        `;
    }
    
    activeFiltersContainer.innerHTML = activeFiltersHTML;
    
    document.querySelectorAll('.active-filter button').forEach(btn => {
        btn.addEventListener('click', function() {
            const filterName = this.getAttribute('data-filter');
            removeFilter(filterName);
        });
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
function debouncedSearch() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        const searchValue = searchInput.value;
        const form = document.getElementById('filtersForm');
        const formData = new FormData(form);
        const params = {};
        
        for (let [key, value] of formData.entries()) {
            params[key] = value;
        }
        params.search = searchValue;
        
        updateURL(params);
        loadProducts(1, params);
    }, 500);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
async function loadProducts(page = 1, additionalParams = {}) {
    if (isLoading) return;
    
    isLoading = true;
    currentPage = page;
    
    const loadingIndicator = document.getElementById('loadingIndicator');
    const productsContainer = document.getElementById('productsContainer');
    const paginationContainer = document.getElementById('paginationContainer');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    if (loadingIndicator) {
        loadingIndicator.style.display = 'block';
    }
    if (page === 1 && productsContainer) {
        productsContainer.style.opacity = '0.5';
    }
    
    try {
        const form = document.getElementById('filtersForm');
        const formData = new FormData(form);
        const params = new URLSearchParams();
        
        for (let [key, value] of formData.entries()) {
            if (value) params.append(key, value);
        }
        
        Object.keys(additionalParams).forEach(key => {
            if (additionalParams[key]) {
                params.append(key, additionalParams[key]);
            }
        });
        
        params.append('page', page);
        
        const response = await fetch(`?${params.toString()}`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
        });
        
        if (!response.ok) throw new Error('Network error');
        
        const data = await response.json();
        
        if (data.success) {
            if (productsContainer) {
                productsContainer.innerHTML = data.products_html;
            }
            
            const resultsCount = document.getElementById('resultsCount');
            if (resultsCount) {
                resultsCount.textContent = data.total_count;
            }
            
            if (paginationContainer && data.has_next) {
                paginationContainer.innerHTML = `
                    ${page > 1 ? `<a href="#" class="pagination-btn" data-page="${page - 1}">‚Üê –ù–∞–∑–∞–¥</a>` : '<span></span>'}
                    <span class="pagination-info">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span id="currentPage">${page}</span> –∏–∑ <span id="totalPages">${data.total_pages}</span>
                    </span>
                    <a href="#" class="pagination-btn" data-page="${data.next_page_number}">–î–∞–ª–µ–µ ‚Üí</a>
                `;
            } else if (paginationContainer) {
                paginationContainer.innerHTML = `
                    ${page > 1 ? `<a href="#" class="pagination-btn" data-page="${page - 1}">‚Üê –ù–∞–∑–∞–¥</a>` : '<span></span>'}
                    <span class="pagination-info">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span id="currentPage">${page}</span> –∏–∑ <span id="totalPages">${data.total_pages}</span>
                    </span>
                    <span class="pagination-info">–ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —Ç–æ–≤–∞—Ä—ã</span>
                `;
            }
            
            initializeProductHandlers();
            
        } else {
            throw new Error('Failed to load products');
        }
        
    } catch (error) {
        console.error('Error loading products:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤', 'error');
    } finally {
        isLoading = false;
        if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
        }
        if (productsContainer) {
            productsContainer.style.opacity = '1';
        }
    }
}

function loadPage(page, event) {
    if (event) event.preventDefault();
    loadProducts(page);
}

function clearAllFilters() {
    const form = document.getElementById('filtersForm');
    const inputs = form.querySelectorAll('input, select');
    
    inputs.forEach(input => {
        if (input.type === 'checkbox') {
            input.checked = false;
        } else if (input.type === 'text' || input.type === 'number') {
            input.value = '';
        } else if (input.tagName === 'SELECT') {
            input.selectedIndex = 0;
        }
    });
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.value = '';
    }
    
    updateURL({});
    
    loadProducts(1, {});
}

function removeFilter(filterName) {
    const form = document.getElementById('filtersForm');
    
    if (filterName === 'search') {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.value = '';
        const hiddenSearch = form.querySelector('input[name="search"]');
        if (hiddenSearch) hiddenSearch.value = '';
    } else if (filterName === 'in_stock') {
        const checkbox = form.querySelector('input[name="in_stock"]');
        if (checkbox) checkbox.checked = false;
    } else if (filterName === 'price') {
        const priceMin = form.querySelector('input[name="price_min"]');
        const priceMax = form.querySelector('input[name="price_max"]');
        if (priceMin) priceMin.value = '';
        if (priceMax) priceMax.value = '';
    } else {
        const select = form.querySelector(`select[name="${filterName}"]`);
        if (select) select.selectedIndex = 0;
    }
    
    updateFilters();
}

function initializeProductHandlers() {
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', handleAddToCart);
    });
    
    document.querySelectorAll('.wishlist-btn').forEach(btn => {
        if (btn.tagName === 'BUTTON') {
            btn.addEventListener('click', handleWishlistToggle);
        }
    });
    
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const view = this.getAttribute('data-view');
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const productsGrid = document.querySelector('.products-grid');
            if (productsGrid) {
                if (view === 'list') {
                    productsGrid.classList.add('list-view');
                } else {
                    productsGrid.classList.remove('list-view');
                }
            }
        });
    });
    
    document.querySelectorAll('.pagination-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const page = this.getAttribute('data-page');
            if (page) {
                loadPage(parseInt(page), e);
            }
        });
    });
    
    document.querySelectorAll('.active-filter button').forEach(btn => {
        btn.addEventListener('click', function() {
            const filterName = this.getAttribute('data-filter');
            removeFilter(filterName);
        });
    });
}

async function handleAddToCart(e) {
    e.preventDefault();
    const productId = this.getAttribute('data-product-id');
    const originalText = this.innerHTML;
    
    this.innerHTML = '‚è≥ –î–æ–±–∞–≤–ª—è–µ–º...';
    this.disabled = true;
    this.classList.add('loading');
    
    try {
        const formData = new FormData();
        const csrfToken = getCSRFToken();
        
        if (csrfToken) {
            formData.append('csrfmiddlewaretoken', csrfToken);
        }
        
        const response = await fetch(`/cart/add/${productId}/`, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: formData,
            credentials: 'same-origin'
        });
        
        if (!response.ok) throw new Error('Network error');
        
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message || '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');
            updateCartCounter(data.cart_count);
            
            this.innerHTML = '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!';
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
                this.classList.remove('loading');
            }, 1500);
        } else {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É');
        }
    } catch (error) {
        console.error('Error:', error);
        showToast(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
        
        this.innerHTML = originalText;
        this.disabled = false;
        this.classList.remove('loading');
    }
}

async function handleWishlistToggle(e) {
    e.preventDefault();
    const productId = this.getAttribute('data-product-id');
    const isInWishlist = this.classList.contains('in-wishlist');
    const icon = this.querySelector('.wishlist-icon');
    
    try {
        const formData = new FormData();
        const csrfToken = getCSRFToken();
        
        if (csrfToken) {
            formData.append('csrfmiddlewaretoken', csrfToken);
        }
        
        const response = await fetch(`/wishlist/toggle/${productId}/`, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: formData,
            credentials: 'same-origin'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            
            updateWishlistCounter(data.wishlist_count);
            
            if (data.action === 'added') {
                this.classList.add('in-wishlist');
                if (icon) icon.textContent = '‚ù§Ô∏è';
                this.setAttribute('title', '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
            } else {
                this.classList.remove('in-wishlist');
                if (icon) icon.textContent = 'ü§ç';
                this.setAttribute('title', '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
            }
            
            if (icon) {
                icon.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    icon.style.transform = 'scale(1)';
                }, 300);
            }
            
        } else {
            throw new Error(data.error);
        }
    } catch (error) {
        console.error('Error:', error);
        showToast(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º', 'error');
    }
}

function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toast-container');
    if (!toastContainer) return;
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <span class="toast-icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
        <span class="toast-message">${message}</span>
    `;
    
    toastContainer.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 100);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

function updateWishlistCounter(count) {
    console.log('Wishlist count updated:', count);
}

function updateCartCounter(count) {
    console.log('Cart count updated:', count);
}

function getCSRFToken() {
    const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
    if (csrfInput) {
        return csrfInput.value;
    }
    
    const metaToken = document.querySelector('meta[name="csrf-token"]');
    if (metaToken) {
        return metaToken.getAttribute('content');
    }
    
    const name = 'csrftoken';
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

document.addEventListener('DOMContentLoaded', function() {
    initializeProductHandlers();
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', debouncedSearch);
    }
    
    const filterSelects = document.querySelectorAll('.filter-select');
    filterSelects.forEach(select => {
        select.addEventListener('change', updateFilters);
    });
    
    const priceInputs = document.querySelectorAll('.price-input');
    priceInputs.forEach(input => {
        input.addEventListener('change', updateFilters);
    });
    
    const inStockCheckbox = document.getElementById('inStockCheckbox');
    if (inStockCheckbox) {
        inStockCheckbox.addEventListener('change', updateFilters);
    }
    
    const clearFiltersBtn = document.getElementById('clearFiltersBtn');
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', clearAllFilters);
    }
    
    let observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !isLoading) {
                const loadMoreBtn = document.querySelector('.pagination-btn');
                if (loadMoreBtn) {
                    loadMoreBtn.click();
                }
            }
        });
    });
    
    const sentinel = document.createElement('div');
    sentinel.id = 'scroll-sentinel';
    const productsContent = document.querySelector('.products-content');
    if (productsContent) {
        productsContent.appendChild(sentinel);
        observer.observe(sentinel);
    }
});

async function updatePriceRange() {
    const category = document.querySelector('select[name="category"]')?.value || '';
    const brand = document.querySelector('select[name="brand"]')?.value || '';
    
    try {
        const response = await fetch(`/api/price-range/?category=${encodeURIComponent(category)}&brand=${encodeURIComponent(brand)}`);
        const data = await response.json();
        
        const priceRangeInfo = document.querySelector('.price-range-info');
        if (priceRangeInfo) {
            priceRangeInfo.textContent = `–î–∏–∞–ø–∞–∑–æ–Ω: ${data.min_price} - ${data.max_price} ‚ÇΩ`;
        }
    } catch (error) {
        console.error('Error updating price range:', error);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.querySelector('select[name="category"]');
    const brandSelect = document.querySelector('select[name="brand"]');
    
    if (categorySelect) {
        categorySelect.addEventListener('change', updatePriceRange);
    }
    if (brandSelect) {
        brandSelect.addEventListener('change', updatePriceRange);
    }
});
</script>
{% endblock %}