<!-- main/templates/main/payment.html -->
{% extends 'main/base.html' %}

{% block title %}–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ - –¢–µ—Ö—Ä–µ—Å—É—Ä—Å{% endblock %}

{% block content %}
<!-- Hero —Å–µ–∫—Ü–∏—è -->
<section class="payment-hero">
    <div class="container">
        <div class="hero-content">
            <h1>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h1>
            <p class="hero-subtitle">–ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</p>
        </div>
    </div>
</section>

<section class="payment-section">
    <div class="container">
        <div class="payment-layout">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
            <div class="order-summary-sidebar">
                <div class="summary-card">
                    <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
                    
                    <div class="order-info">
                        <div class="info-row">
                            <span>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</span>
                            <strong>#{{ order.id }}</strong>
                        </div>
                        <div class="info-row">
                            <span>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</span>
                            <strong class="total-amount">{{ order.total_price }} —Ä—É–±.</strong>
                        </div>
                        <div class="info-row">
                            <span>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span>
                            <span>{{ order.get_payment_method_display }}</span>
                        </div>
                        <div class="info-row">
                            <span>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                            <span class="address">{{ order.delivery_address }}</span>
                        </div>
                    </div>

                    <div class="order-items">
                        <h4>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</h4>
                        {% for item in order.orderitem_set.all %}
                        <div class="order-item">
                            <div class="item-image">
                                {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" loading="lazy">
                                {% else %}
                                <div class="image-placeholder">
                                    <span class="placeholder-icon">‚öôÔ∏è</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="item-details">
                                <span class="item-name">{{ item.product.name }}</span>
                                <span class="item-quantity">x{{ item.quantity }}</span>
                            </div>
                            <span class="item-price">{{ item.get_total_price }} —Ä—É–±.</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="security-card">
                    <div class="security-icon">üîí</div>
                    <h4>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞</h4>
                    <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã SSL-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º</p>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
            <div class="payment-main">
                <div class="payment-card">
                    <h2>–û–ø–ª–∞—Ç–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π</h2>
                    
                    <form method="post" class="payment-form">
                        {% csrf_token %}
                        
                        <div class="form-section">
                            <label class="form-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
                            <input type="text" 
                                   class="form-input card-number" 
                                   placeholder="0000 0000 0000 0000" 
                                   maxlength="19" 
                                   required
                                   pattern="[0-9\s]{13,19}">
                            <div class="card-icons">
                                <span class="card-icon">üí≥</span>
                                <span class="card-icon">üîê</span>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-section">
                                <label class="form-label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                                <input type="text" 
                                       class="form-input" 
                                       placeholder="–ú–ú/–ì–ì" 
                                       maxlength="5" 
                                       required
                                       pattern="(0[1-9]|1[0-2])\/[0-9]{2}">
                            </div>
                            <div class="form-section">
                                <label class="form-label">CVV/CVC</label>
                                <input type="text" 
                                       class="form-input" 
                                       placeholder="000" 
                                       maxlength="3" 
                                       required
                                       pattern="[0-9]{3}">
                                <div class="cvv-hint" title="3 —Ü–∏—Ñ—Ä—ã –Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ –∫–∞—Ä—Ç—ã">?</div>
                            </div>
                        </div>

                        <div class="form-section">
                            <label class="form-label">–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã</label>
                            <input type="text" 
                                   class="form-input" 
                                   placeholder="IVAN IVANOV" 
                                   required
                                   pattern="[A-Z\s]+">
                        </div>

                        <div class="security-notice">
                            <div class="notice-icon">üõ°Ô∏è</div>
                            <div class="notice-text">
                                <strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π</strong>
                                <small>–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É PCI DSS</small>
                            </div>
                        </div>

                        <button type="submit" class="pay-now-btn">
                            <span class="btn-icon">üí≥</span>
                            –û–ø–ª–∞—Ç–∏—Ç—å {{ order.total_price }} —Ä—É–±.
                        </button>
                    </form>

                    <div class="test-info">
                        <h4>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ:</h4>
                        <div class="test-cards">
                            <div class="test-card">
                                <strong>–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:</strong>
                                <code>4242 4242 4242 4242</code>
                            </div>
                            <div class="test-card">
                                <strong>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤:</strong>
                                <code>4000 0000 0000 9995</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Hero —Å–µ–∫—Ü–∏—è */
.payment-hero {
    background: linear-gradient(135deg, #0052cc 0%, #0066cc 100%);
    color: white;
    padding: 80px 0 40px;
    text-align: center;
}

.payment-hero h1 {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
}

.hero-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è */
.payment-section {
    padding: 3rem 0;
    background: #f8f9fa;
    min-height: 70vh;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* –ú–∞–∫–µ—Ç –æ–ø–ª–∞—Ç—ã */
.payment-layout {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 2rem;
    align-items: start;
}

/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ */
.order-summary-sidebar {
    position: sticky;
    top: 2rem;
}

.summary-card, .security-card {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
}

.summary-card h3 {
    font-size: 1.3rem;
    color: #2c3e50;
    margin: 0 0 1.5rem 0;
    text-align: center;
    border-bottom: 2px solid #0052cc;
    padding-bottom: 0.5rem;
}

.order-info {
    margin-bottom: 2rem;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f1f3f4;
}

.info-row:last-child {
    border-bottom: none;
}

.total-amount {
    font-size: 1.3rem;
    color: #0052cc;
    font-weight: 700;
}

.address {
    text-align: right;
    font-size: 0.9rem;
    color: #6c757d;
    max-width: 150px;
}

/* –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ */
.order-items h4 {
    font-size: 1.1rem;
    color: #2c3e50;
    margin: 0 0 1rem 0;
}

.order-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid #f1f3f4;
}

.order-item:last-child {
    border-bottom: none;
}

.item-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    overflow: hidden;
    background: #f8f9fa;
    flex-shrink: 0;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.image-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e9ecef;
    color: #6c757d;
}

.placeholder-icon {
    font-size: 1.2rem;
}

.item-details {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.item-name {
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
}

.item-quantity {
    color: #6c757d;
    font-size: 0.8rem;
}

.item-price {
    font-weight: 700;
    color: #0052cc;
    flex-shrink: 0;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ */
.security-card {
    text-align: center;
    background: linear-gradient(135deg, #48bb78, #38a169);
    color: white;
}

.security-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.security-card h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1.2rem;
}

.security-card p {
    margin: 0;
    opacity: 0.9;
    font-size: 0.9rem;
}

/* –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å —Ñ–æ—Ä–º–æ–π –æ–ø–ª–∞—Ç—ã */
.payment-main {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.payment-card h2 {
    font-size: 1.5rem;
    color: #2c3e50;
    margin: 0 0 2rem 0;
    text-align: center;
}

/* –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã */
.payment-form {
    max-width: 400px;
    margin: 0 auto;
}

.form-section {
    margin-bottom: 1.5rem;
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
}

.form-input {
    width: 100%;
    padding: 1rem;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
    box-sizing: border-box;
}

.form-input:focus {
    outline: none;
    border-color: #0052cc;
    box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
    transform: translateY(-1px);
}

.form-input::placeholder {
    color: #a0aec0;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –∫–∞—Ä—Ç—ã */
.card-number {
    padding-right: 60px;
}

.card-icons {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 0.5rem;
}

.card-icon {
    font-size: 1.2rem;
    opacity: 0.7;
}

.cvv-hint {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    background: #e9ecef;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    cursor: help;
    color: #6c757d;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ */
.security-notice {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: #f0f9ff;
    padding: 1rem;
    border-radius: 12px;
    border: 1px solid #bae6fd;
    margin: 2rem 0;
}

.notice-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.notice-text {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.notice-text strong {
    color: #0369a1;
    font-size: 0.9rem;
}

.notice-text small {
    color: #6c757d;
    font-size: 0.8rem;
}

/* –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã */
.pay-now-btn {
    width: 100%;
    padding: 1.25rem;
    background: linear-gradient(135deg, #48bb78, #38a169);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.pay-now-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
}

.pay-now-btn:active {
    transform: translateY(0);
}

/* –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
.test-info {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e9ecef;
}

.test-info h4 {
    font-size: 1rem;
    color: #6c757d;
    margin: 0 0 1rem 0;
    text-align: center;
}

.test-cards {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.test-card {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #0052cc;
}

.test-card strong {
    display: block;
    margin-bottom: 0.25rem;
    color: #2c3e50;
    font-size: 0.9rem;
}

.test-card code {
    background: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: #0052cc;
    border: 1px solid #e9ecef;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .payment-layout {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .order-summary-sidebar {
        position: static;
    }
}

@media (max-width: 768px) {
    .payment-hero h1 {
        font-size: 2rem;
    }
    
    .payment-main {
        padding: 1.5rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .test-cards {
        grid-template-columns: 1fr;
    }
    
    .order-item {
        flex-wrap: wrap;
    }
    
    .item-details {
        min-width: 0;
    }
}

@media (max-width: 480px) {
    .payment-section {
        padding: 1.5rem 0;
    }
    
    .container {
        padding: 0 15px;
    }
    
    .summary-card, .security-card {
        padding: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
    const cardNumberInput = document.querySelector('.card-number');
    if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = '';
            
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            
            e.target.value = formattedValue;
        });
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    const expiryInput = document.querySelector('input[placeholder="–ú–ú/–ì–ì"]');
    if (expiryInput) {
        expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    const form = document.querySelector('.payment-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const cardNumber = document.querySelector('.card-number').value.replace(/\s/g, '');
            const cvv = document.querySelector('input[placeholder="000"]').value;
            
            if (cardNumber.length !== 16) {
                e.preventDefault();
                showError('–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 16 —Ü–∏—Ñ—Ä');
                return;
            }
            
            if (cvv.length !== 3) {
                e.preventDefault();
                showError('CVV –∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 —Ü–∏—Ñ—Ä—ã');
                return;
            }
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
            const payButton = document.querySelector('.pay-now-btn');
            payButton.disabled = true;
            payButton.innerHTML = '<span class="btn-icon">‚è≥</span> –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...';
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
            setTimeout(() => {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                console.log('–ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
            }, 2000);
        });
    }

    function showError(message) {
        // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-notification';
        errorDiv.innerHTML = `
            <div class="error-icon">‚ùå</div>
            <div class="error-text">${message}</div>
        `;
        
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fed7d7;
            color: #c53030;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            border: 1px solid #feb2b2;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        `;
        
        document.body.appendChild(errorDiv);
        
        setTimeout(() => {
            errorDiv.remove();
        }, 5000);
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.style.transform = 'translateY(-2px)';
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.style.transform = 'translateY(0)';
        });
    });
});

// –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}